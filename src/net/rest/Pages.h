#if ENABLE_WEB_PAGE 
const char* WEB_PAGE_MAIN = R"=====(<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartThingDevice</title>
    <script type="module" crossorigin src="/assets/index.js"></script>
    <link rel="stylesheet" href="/assets/index.css">
  </head>
  <body>
    <h1 class="title">Control panel</h1>
    <div id="control-panel" class="bordered"></div>
    <div id="toasts-list" class="list"></div>
  </body>
</html>)=====";

const char* STYLE_PAGE_MAIN =
    R"=====(:root{--vt-c-black: #181818;--vt-c-black-soft: #484848;--vt-c-black-mute: #282828;--vt-c-indigo: #2c3e50;--vt-c-divider-dark-1: rgba(84, 84, 84, .65);--vt-c-divider-dark-2: rgba(84, 84, 84, .48);--vt-c-text-dark-1: var(--vt-c-white);--vt-c-text-dark-2: rgba(235, 235, 235, .64);--color-positive: hsla(160, 100%, 37%, 1);--color-accent: #2c3e50;--color-danger: rgba(147, 4, 4, .453);--vt-c-svg-fill: #666666;--background-tilt: #141313cd;--doc-height: 50px;--border-radius: 10px;--section-gap: 160px;--default-gap: 2px;--toast-width: 300px;--toast-min-height: 50px;--icon-size: 35px;--menu-item-width: 250px}:root{--color-background: var(--vt-c-black);--color-background-soft: var(--vt-c-black-soft);--color-background-mute: var(--vt-c-black-mute);--color-border: var(--vt-c-divider-dark-2);--color-border-hover: var(--vt-c-divider-dark-1);--color-heading: var(--vt-c-text-dark-1);--color-text: var(--vt-c-text-dark-2);--color-svg-fill: var() }*,*:before,*:after{box-sizing:border-box;margin:0;font-weight:400}body{min-height:100vh;color:var(--color-text);background:var(--color-background);transition:color .5s,background-color .5s;line-height:1.6;font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-size:15px;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#control-panel{display:flex;flex-direction:row;column-gap:var(--default-gap);margin:0 auto;width:1000px}#toasts-list{position:absolute;bottom:5px;right:5px;z-index:999}.title{text-align:center;text-decoration:none;color:var(--color-positive)}.btn{background-color:#00bd7e33;border-color:transparent;border-radius:var(--border-radius);min-width:90px;min-height:40px;color:#000}.btn:hover{opacity:.5;cursor:pointer}input,select{min-height:40px;font-size:18px;background-color:var(--color-background);color:var(--color-text);outline:none;border:1px solid var(--color-border);border-radius:var(--border-radius)}.bordered{border:solid 2px var(--color-border);border-radius:var(--border-radius);padding:2px}.container{display:flex;flex-direction:column;gap:var(--default-gap);height:100%}.field-container{display:grid;grid-template-columns:1fr 1fr;border-radius:var(--border-radius)}input,select{background-color:var(--color-background);color:var(--color-text);outline:none;border:1px solid var(--color-border);border-radius:var(--border-radius)}.field-container .input-with-slot{display:flex;flex-direction:row;border:1px solid var(--color-border);border-radius:var(--border-radius)}.input-with-slot input{width:100%;border:none}.field-label{text-align:center}.list{display:flex;flex-direction:column;row-gap:var(--default-gap)}.required{background-color:#bd090033;color:#000}.menu-panel{display:flex;flex-direction:row;flex:1 0 auto}.menu-items{width:var(--menu-item-width);padding:2px}.menu-items h2{transition:.5s;cursor:pointer;border-radius:var(--border-radius);padding:5px;text-align:center;word-wrap:break-word}.menu-items h2:hover{transition:background-color .5s;background-color:var(--color-background-mute)}.menu-item-content{position:relative;width:calc(100% - var(--menu-item-width));margin-left:5px}.menu-selected{background-color:var(--vt-c-black-soft)}.update-button{position:absolute;top:0;right:0;display:none}.controls-holder{margin-top:auto;display:flex;flex-direction:row;gap:var(--default-gap)}.controls-holder button{width:100%}.hook-title{flex:1 1 auto;text-align:start}.hook-header{display:flex;flex-direction:row;gap:var(--default-gap);position:relative}.hooks-list-view{max-height:80vh;overflow-y:auto;margin-top:var(--default-gap)}.hooks-list-view .container{border-top:1px solid var(--color-border)}.hook-view-controls{display:flex;flex-direction:row-reverse;column-gap:var(--default-gap);align-items:center}.toast{position:relative;border:1px solid var(--color-border);border-radius:var(--border-radius);width:var(--toast-width);min-height:var(--toast-min-height);padding:10px 5px 5px;z-index:1000;transition:.4s}.toast button{background-color:transparent;border-color:transparent;position:absolute;top:0;right:0;outline:none;-webkit-user-select:none;user-select:none}.toast h2,h3{text-align:center}.br{border-right:2px solid var(--color-border)}.bt{border-top:2px solid var(--color-border)})=====";

const char* SCRIPT_PAGE_MAIN = R"=====(var F=Object.defineProperty;var D=(t,e,i)=>e in t?F(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var T=(t,e,i)=>(D(t,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();const r={title:(t,e="h1")=>{const i=document.createElement(e);return i.classList.add("title"),i.innerHTML=t,i},container:(t={bordered:!1})=>{const e=document.createElement("div");return e.classList.add("container"),t.bordered&&e.classList.add("bordered"),e},list:()=>{const t=document.createElement("div");return t.classList.add("list"),t},button:({id:t,label:e,labelElement:i="h2",onClick:n,danger:s=!1,visible:o=!0})=>{const a=document.createElement("button");t&&(a.id=t),a.classList.add("btn");const c=`<${i}>${e}</${i}>`;return a.innerHTML=c,n&&(a.onclick=async()=>{a.disabled=!0,a.innerHTML="Loading...";try{await n()}catch(l){console.error(l)}finally{a.innerHTML=c,a.disabled=!1}}),s&&(a.style.backgroundColor="var(--color-danger)"),o||(a.style.display="none"),a},icon:({id:t,icon:e,title:i,onClick:n=()=>{},visible:s=!0})=>{const o=document.createElement("span");return t&&(o.id=t),o.ariaHidden=!0,o.role="img",o.innerHTML=e,s||(o.style.display="none"),i&&(o.title=i),o.style.cursor="pointer",o.onclick=n,o},input:({id:t,label:e,value:i,disabled:n=!1,type:s="text",slot:o,props:a={}})=>{const c=document.createElement("div");c.classList.add("field-container");const l=document.createElement("h2");l.classList.add("field-label"),l.innerHTML=e;const m=document.createElement("div");m.classList.add("input-with-slot");const p=document.createElement("input");return t&&(p.id=t),p.disabled=n,p.value=i,p.type=s,Object.entries(a).forEach(([g,w])=>p.setAttribute(g,w)),m.appendChild(p),o&&m.appendChild(o),c.append(l,m),c},combobox:({id:t,value:e,values:i,label:n,disabled:s=!1,onChange:o,props:a={}})=>{const c=document.createElement("div");if(c.classList.add("field-container"),n){const m=document.createElement("h2");m.classList.add("field-label"),m.innerHTML=n,c.appendChild(m)}const l=document.createElement("select");return t&&(l.id=t),l.disabled=s,l.appendChild(document.createElement("option")),o&&(l.onchange=()=>o(l.value)),Object.entries(a).forEach(([m,p])=>l.setAttribute(m,p)),c.append(l),I(c,i),e&&(l.value=e),c},tree:t=>{const e=document.createElement("ul");return Object.entries(t).forEach(([i,n])=>e.appendChild(M({key:i,value:n}))),e},controlsHolder:()=>{const t=document.createElement("div");return t.classList.add("controls-holder"),t}},b={pencil:'<svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"></path></svg>',trash:'<svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"></path></svg>',cross:'<svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path d="M13.46,12L19,17.54V19H17.54L12,13.46L6.46,19H5V17.54L10.54,12L5,6.46V5H6.46L12,10.54L17.54,5H19V6.46L13.46,12Z"></path></svg>',save:'<svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"></path></svg>',update:'<svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"></path></svg>',tube:'<svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path d="M7,2V4H8V18A4,4 0 0,0 12,22A4,4 0 0,0 16,18V4H17V2H7M11,16C10.4,16 10,15.6 10,15C10,14.4 10.4,14 11,14C11.6,14 12,14.4 12,15C12,15.6 11.6,16 11,16M13,12C12.4,12 12,11.6 12,11C12,10.4 12.4,10 13,10C13.6,10 14,10.4 14,11C14,11.6 13.6,12 13,12M14,7H10V4H14V7Z"></path></svg>'};function I(t,e){if(!e)return;const i=t.getElementsByTagName("select")[0];if(!i){console.error("Can't find select in combobox");return}let n;Array.isArray(e)?n=e.map(s=>({key:s,caption:s})):n=Object.entries(e).map(([s,o])=>({key:s,caption:o})),n.forEach(({key:s,caption:o})=>{const a=document.createElement("option");a.value=s,a.innerHTML=o,i.appendChild(a)})}const M=({key:t,value:e})=>{const i=document.createElement("li");return i.append(t+": ",_(e)),i},_=t=>{if(Array.isArray(t)){const e=document.createElement("ul");return t.forEach(i=>{const n=document.createElement("li");n.innerHTML=i,e.appendChild(n)}),e}else if(t instanceof Object){const e=document.createElement("ul");return Object.entries(t).forEach(([i,n])=>{const s=document.createElement("li");s.appendChild(M({key:i,value:n})),e.appendChild(s)}),e}else{const e=document.createElement("span");return e.innerHTML=t,e}};class L{constructor(e,i,n){T(this,"selected",{});this.id=e,this.menuItems=i,this.placeholder=n}create(){const e=document.createElement("div");e.classList.add("menu-panel"),this.viewDiv=document.createElement("div"),this.viewDiv.classList.add("menu-items","list","br"),this.viewDiv.id=this.id,Object.entries(this.menuItems).forEach(([n,{name:s}])=>{const o=document.createElement("h2");o.id=n,o.innerHTML=s,o.onclick=()=>this.open(n),this.viewDiv.appendChild(o)}),this.contentDiv=document.createElement("div"),this.contentDiv.classList.add("menu-item-content"),this.contentDiv.id=this.id+"-content",this.loadingTitle=r.title("Loading...","h2"),this.loadingTitle.style.display="none",this.contentDiv.appendChild(this.loadingTitle);const i=r.icon({id:this.id+"-update",icon:b.update,onClick:()=>this.updateContent()});return i.classList.add("update-button"),this.contentDiv.appendChild(i),e.append(this.viewDiv,this.contentDiv),e}open(e){const i=document.getElementById(e);if(!i){console.error("Failed to open menuItem id="+e+": element not found");return}this.selected.item&&(this.selected.item.classList.remove("menu-selected"),this.selected.content.style.display="none");let n=document.getElementById(e+"-content");n?n.style.display="":(n=this.createContent(e),this.contentDiv.appendChild(n)),i.classList.add("menu-selected"),this.selected.name=e,this.selected.item=i,this.selected.content=n,document.getElementById(this.id+"-update").style.display="unset"}updateContent(){this.selected&&(this.selected.content.remove(),this.selected.content=this.createContent(this.selected.name),this.contentDiv.appendChild(this.selected.content))}createContent(e){const i=e+"-content",n=r.container();return n.id=i,this.menuItems[e].title&&n.appendChild(r.title(this.menuItems[e].title)),this.loadContent(n,e),n}async loadContent(e,i){try{this.loading(!0),e.appendChild(await this.menuItems[i].content()??r.container())}catch(n){console.error(n)}finally{this.loading(!1)}}loading(e){this.loadingTitle.style.display=e?"":"none"}}let{hostname:E}=window.location;E==="localhost"&&(E="192.168.2.2");const v="Something gone wrong",h={info:async()=>(await u({path:"/info/system"})).data,actions:async()=>(await u({path:"/info/actions"})).data,configInfo:async()=>(await u({path:"/info/config"})).data,getWifi:async()=>(await u({path:"/wifi"})).data,saveWifi:async t=>{await u({path:"/wifi",method:"POST",payload:t})},saveName:async t=>{await u({path:"/info/system",method:"PUT",payload:{name:t}})},execAction:async t=>{await u({method:"PUT",path:"/actions",params:{action:t}})},sensors:async()=>(await u({path:"/sensors"})).data,states:async()=>(await u({path:"/states"})).data,config:async()=>(await u({path:"/config"})).data,dropConfig:async()=>{await u({method:"DELETE",path:"/config/delete/all"})},saveConfig:async t=>{await u({method:"POST",path:"/config",payload:t})},hooks:async({observable:{name:t,type:e}})=>(await u({path:"/hooks/by/observable",params:{name:t,type:e}})).data,hooksTemplates:async t=>(await u({path:"/hooks/templates",params:{type:t}})).data,createHook:async({observable:{name:t,type:e},hook:i})=>{await u({path:"/hooks",method:"POST",payload:{observable:{name:t,type:e},hook:i}})},updateHook:async({observable:{name:t,type:e},hook:i})=>{await u({path:"/hooks",method:"PUT",payload:{observable:{name:t,type:e},hook:i}})},deleteHook:async({observable:{name:t,type:e},id:i})=>{await u({path:"/hooks",method:"DELETE",params:{name:t,type:e,id:i}})},testHook:async({observable:{name:t,type:e},id:i,value:n})=>{await u({path:"/hooks/test",method:"GET",params:{name:t,type:e,id:i}})},features:async()=>(await u({path:"/features"})).data,metrics:async()=>(await u({path:"/metrics"})).data};function $(t){if(!t||!Object.keys(t))return"";const e=Object.entries(t).map(([i,n])=>`${i}=${n}`);return e.length>0?"?"+e.join("&"):""}function u({method:t="GET",path:e,payload:i,params:n}){let s=new XMLHttpRequest;s.open(t,`http://${E}${e[0]!="/"?"/":""}${e}${$(n)}`,!0),s.setRequestHeader("Accept","application/json"),i&&s.setRequestHeader("Content-Type","application/json");let o;const a=new Promise(c=>o=c);return s.onloadend=()=>{let c;try{c=s.response?JSON.parse(s.response):null}catch(l){console.log(l)}o({data:c,status:s.status})},s.send(i?JSON.stringify(i):null),a}let B=0;const V=5e3,f={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error"};function A(t){const e=document.getElementById(t);e&&e.remove()}function j(t){switch(t){case f.ERROR:return"rgb(171, 12, 12)";case f.SUCCESS:return"rgb(2, 147, 74)";case f.WARNING:return"rgb(147, 106, 2)";default:return"rgb(0, 112, 122)"}}function y({type:t=f.INFO,caption:e,description:i=""}){const n=document.createElement("div");n.classList.add("toast");const s="toast-"+B++;n.id=s,n.style.backgroundColor=j(t);const o=document.createElement("h2");o.id=s+"-caption",o.innerHTML=e;const a=document.createElement("div");a.id=s+"-description",a.style.overflowWrap="break-word",a.innerHTML=i;const c=document.createElement("button");c.id=s+"-close",c.innerHTML="X",c.onclick=()=>A(s),n.append(o,a,c),document.getElementById("toasts-list").appendChild(n),setTimeout(()=>A(s),V)}const d={info:({caption:t,description:e})=>y({caption:t,description:e}),error:({caption:t,description:e})=>y({type:f.ERROR,caption:t,description:e}),success:({caption:t,description:e})=>y({type:f.SUCCESS,caption:t,description:e}),warning:({caption:t,description:e})=>y({type:f.WARNING,caption:t,description:e})},N={name:"Information",title:"Device information",content:async()=>{const t=await h.info();if(!t){d.error({caption:v,description:"Failed to fetch system information"});return}document.title=`SmartThing ${t.name}(${t.type})`;const e=r.list();return e.append(r.input({id:"device-name",label:"Device name",value:t.name||"",slot:r.button({id:"save-device-name",label:"save",onClick:async()=>{const i=document.getElementById("device-name"),n=i.value;if(!n||n.length===0){i.classList.add("required"),d.error({caption:"Device name can't be empty!"});return}try{await h.saveName(n),d.success({caption:"Name updated",description:"New device name: "+n})}catch{d.error({caption:"Name update failed",description:"Failed to update device name"})}finally{i.classList.remove("required")}}})}),r.input({label:"Device type",value:t.type,disabled:!0}),r.input({label:"Firmware version",value:t.version,disabled:!0,type:"number"}),r.input({label:"Chip model",value:t.chip_model,disabled:!0}),r.input({label:"Chip revision",value:t.chip_revision,disabled:!0})),e}},x={name:"WiFi",title:"WiFi settings",content:async()=>{const{settings:t,modes:e}=await h.getWifi();if(!t){d.error({caption:v,description:"Failed to fetch WiFi settings"});return}const i=r.list();i.append(r.input({id:"ssid",label:"SSID",value:t.ss||""}),r.input({id:"password",label:"password",value:t.ps||""}),r.combobox({id:"mode",label:"mode",values:e,value:t.md}));const n=r.controlsHolder();n.appendChild(r.button({label:"Save and reconnect",onClick:async()=>{try{await h.saveWifi({ssid:document.getElementById("ssid").value||"",password:document.getElementById("password").value||"",mode:document.getElementById("mode").value||""}),d.success({caption:"WiFi settings updated"})}catch{d.error({caption:"Failed to update WiFi settings",description:"Check device logs for additional information"})}}}));const s=r.container();return s.append(i,n),s}},R={name:"Actions",title:"Actions list",content:async()=>{const t=await h.actions();if(!t)return r.title("No actions configured");const e=r.list();return Object.entries(t).forEach(([i,n])=>{e.appendChild(r.button({id:"action_"+i,label:n,labelElement:"h1",onClick:async()=>{try{await h.execAction(i),d.success({caption:"Done",description:`Action "${n}" performed successfully`})}catch{d.error({caption:"Action failed",description:`Failed to perform action "${n}"`})}}}))}),e}};function k(t){return typeof t!="string"||t.length==0?"":t.split("").reduce((e,i)=>(i==="_"?e+=" ":i===i.toUpperCase()?e+=" "+i.toLowerCase():e+=i,e),"")}const W=["id","type","readonly"];function P(t){return W.includes(t)}class O{constructor({id:e="",hook:i,template:n,observable:s,parent:o}){this.id=e,this.hook=i,this.template=n,this.observable=s,this.parent=o,this.fields=Object.entries(this.hook).filter(([a,c])=>!P(a)).reverse(),this.controls={test:r.icon({icon:b.tube,onClick:()=>this.test(),title:"Make a test hook call"}),delete:r.icon({icon:b.trash,onClick:()=>this.delete()}),edit:r.icon({icon:b.pencil,onClick:()=>this.edit()}),cancel:r.icon({icon:b.cross,onClick:()=>this.cancel(),visible:!1}),save:r.icon({icon:b.save,onClick:()=>this.save(),visible:!1})}}create(){const e=document.getElementById(this.id);if(this.id&&e)return e;const i=r.container();i.id=this.id;const n=document.createElement("div");n.classList.add("hook-header");const{id:s,caption:o,type:a}=this.hook,c=r.title(`[${s}] ${o||k(a)}`,"h2");c.classList.add("hook-title");const l=document.createElement("div");l.classList.add("hook-view-controls"),Object.values(this.controls).forEach(p=>l.appendChild(p)),n.append(c,l);const m=r.list();return this.fields.forEach(([p,g])=>{const{required:w}=this.template[p]||!1,H={id:`cb_${s}_${p}`,label:k(p),value:g,disabled:!0,props:{required:w}};let C;this.template[p]&&this.template[p].values?C=r.combobox({...H,values:this.template[p].values}):C=r.input(H),m.appendChild(C)}),i.append(n,m),i}edit(e=!0){this.fields.forEach(([i,n])=>{document.getElementById(`cb_${this.hook.id}_${i}`).disabled=!e}),e?(this.controlsVisibile(["cancel","save"],!0),this.controlsVisibile(["delete","edit","test"],!1)):(this.controlsVisibile(["cancel","save"],!1),this.controlsVisibile(["delete","edit","test"],!0))}controlsVisibile(e,i){e.forEach(n=>this.controls[n].style.display=i?"":"none")}validate(){let e=!0;return this.fields.forEach(([i,n])=>{const s=document.getElementById(`cb_${this.hook.id}_${i}`);s.getAttribute("required")=="true"&&!s.value&&(e=!1,s.classList.add("required"))}),e}async save(){if(this.validate()){this.fields.forEach(([e,i])=>{this.hook[e]=document.getElementById(`cb_${this.hook.id}_${e}`).value});try{this.hook.id==="New"?(delete this.hook.id,await h.createHook({observable:this.observable,hook:this.hook})):await h.updateHook({observable:this.observable,hook:this.hook}),d.success({caption:`Hook ${this.hook.id==="New"?"created":"updated"}!`}),document.getElementById(this.id).remove(),this.parent.update()}catch{d.error({caption:"Failed to save toast",description:"Check device logs for additional information"})}}}async delete(){if(confirm("Are you sure you wan to delete hook "+this.hook.id+"?"))try{await h.deleteHook({observable:this.observable,id:this.hook.id}),d.success({caption:"Hook deleted"}),this.parent.update()}catch{d.error({caption:"Failed to delete hook",description:"Check device logs for additional information"})}}async test(){try{await h.testHook({observable:this.observable,id:this.hook.id}),d.success({caption:"Hook called successfully!"})}catch(e){console.error(e),d.error({caption:"Failed to call hook"})}}cancel(){this.hook.id==="New"?(document.getElementById(this.id).remove(),this.parent.update()):this.edit(!1)}}class S{constructor({id:e="",observable:i}){this.id=e,this.observable=i}create(){const e=document.getElementById(this.id);if(this.id&&e)return e;const i=document.createElement("div");return i.id=this.id,this.comboboxTemplates=r.combobox({values:[],label:"Add hook of type",onChange:n=>{this.addNewHook(n)}}),this.list=r.list(),this.list.id="cb_list_"+this.id,this.list.classList.add("hooks-list-view"),i.append(this.comboboxTemplates,this.list),this.firstLoad(),i}update(){this.loadHooks()}async firstLoad(){await this.loadTemplates(),this.loadHooks()}async loadTemplates(){this.templates=await h.hooksTemplates(this.observable.type),this.templates&&I(this.comboboxTemplates,Object.keys(this.templates).filter(e=>e!=="default").reduce((e,i)=>(e[i]=k(i),e),{}))}async loadHooks(){if(this.list.innerHTML="",this.hooks=await h.hooks({observable:this.observable}),!this.hooks||this.hooks.length===0){this.list.appendChild(r.title("No hooks added yet","h3"));return}this.hooks.forEach(e=>this.list.appendChild(new O({id:"cb_"+e.id,hook:e,template:{...this.templates[e.type],...this.templates.default},observable:this.observable,parent:this}).create()))}addNewHook(e){const i=document.getElementById("cb_new");if(i&&i.remove(),!e)return;const n={...this.templates[e],...this.templates.default},s=Object.entries(n).reduce((a,[c,l])=>(a[c]=l.default||"",a),{id:"New",type:e}),o=new O({id:"cb_new",hook:s,template:n,observable:this.observable,parent:this});this.list.prepend(o.create()),o.edit()}}const q={name:"Sensors",title:"Sensors values",content:async()=>{const t=await h.sensors();if(!t||Object.keys(t).length===0)return r.title("No sensors configured","h2");const e=Object.entries(t).reduce((n,[s,{value:o,type:a}])=>(n["sensors-menu-"+s]={name:`${s} (${a}): ${o}`,title:"Hooks",content:async()=>{var c,l;return((c=window.features)==null?void 0:c.hooks)===void 0||((l=window.features)==null?void 0:l.hooks)==!0?new S({id:"cb_view_"+s,observable:{type:"sensor",name:s}}).create():r.title("Hooks feature disabled in this build","h2")}},n),{}),i=new L("sensors-menu",e).create();return i.classList.add("bt"),i}},U={name:"States",title:"Device states values",content:async()=>{const t=await h.states();if(!t||Object.keys(t).length===0)return r.title("No states configured","h2");const e=Object.entries(t).reduce((n,[s,o])=>(n["state-menu-"+s]={name:`${s}: ${o}`,title:"Hooks",content:async()=>{var a,c;return((a=window.features)==null?void 0:a.hooks)===void 0||((c=window.features)==null?void 0:c.hooks)==!0?new S({id:"cb_view_"+s,observable:{type:"state",name:s}}).create():r.title("Hooks feature disabled in this build","h2")}},n),{}),i=new L("states-menu",e).create();return i.classList.add("bt"),i}},Z={name:"Configuration",title:"Configuration values",content:async()=>{const t=await h.configInfo();if(!t){d.error({caption:v,description:"Failed to fetch configuration information"});return}if(Object.keys(t).length===0)return r.title("No config entries","h2");const e=await h.config();if(!e){d.error({caption:v,description:"Failed to fetch configuration values"});return}const i=r.list();Object.entries(t).forEach(([o,{caption:a,type:c}])=>{i.appendChild(r.input({id:o,label:a,type:c,value:e[o]||""}))});const n=r.controlsHolder();n.append(r.button({id:"config-delete",label:"Delete all values",danger:!0,onClick:async()=>{if(confirm("Are you sure you want to delete all configuration values?"))try{await h.dropConfig(),d.success({caption:"All values removed"})}catch{d.error({caption:"Failed to delete configuration values"})}}}),r.button({id:"config-save",label:"Save",onClick:async()=>{const o={};Object.keys(t).forEach(a=>o[a]=document.getElementById(a).value);try{await h.saveConfig(o),d.success({caption:"Configuration updated"})}catch{d.error({caption:"Failed to save configuration values"})}}}));const s=r.container();return s.append(i,n),s}},G={name:"Metrics",title:"Device metrics",content:async()=>{try{return r.tree(await h.metrics())}catch(t){console.log(t),d.error({caption:v,description:"Failed to fetch device metrics"})}}},J={info:N,wifi:x,actions:R,sensors:q,states:U,configuration:Z,metrics:G};window.onload=async()=>{const t=await h.features().catch(i=>{console.log("Failed to load features",i),d.error({caption:"Failed to load device features"})})??{},e=new L("menu-main",Object.entries(J).reduce((i,[n,s])=>((t[n]===void 0||t[n]===!0)&&(i[n]=s),i),{}));window.features=t,document.getElementById("control-panel").appendChild(e.create()),e.open("info")};)=====";
#endif